/**
 * @class Ext.ux.ColorPicker
 * @extends Ext.BoxComponent
 * This is a color picker.
 * @license: LGPLv3
 * @author: Amon
 * @constructor
 * Creates a new ColorPicker
 * @param {Object} config Configuration options
 * @version 1.1.2
 */
Ext.namespace("Ext.ux"),Ext.ux.ColorPicker=Ext.extend(Ext.BoxComponent,{initComponent:function(){this.applyDefaultsCP(),Ext.ux.ColorPicker.superclass.initComponent.apply(this,arguments),this.addEvents("select")},onRender:function(){Ext.ux.ColorPicker.superclass.onRender.apply(this,arguments),this.body=this.body||this.container||this.renderTo||Ext.DomHelper.append(Ext.getBody(),{},!0),this.el||(this.el=this.body,this.cls&&Ext.get(this.el).addClass(this.cls)),this.renderComponent()},applyDefaultsCP:function(){Ext.apply(this,{cls:"x-cp-mainpanel",resizable:this.resizable||!1,HSV:{h:0,s:0,v:0},updateMode:null})},renderComponent:function(){Ext.DomHelper.append(this.body,{id:this.cpGetId("rgb"),cls:"x-cp-rgbpicker"}),Ext.DomHelper.append(this.body,{id:this.cpGetId("hue"),cls:"x-cp-huepicker"}),this.huePicker=Ext.DomHelper.append(this.body,{cls:"x-cp-hueslider"}),this.hueDD=new Ext.dd.DD(this.huePicker,"huePicker"),this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3}),this.hueDD.onDrag=this.moveHuePicker.createDelegate(this),Ext.get(this.cpGetId("hue")).on("mousedown",this.clickHUEPicker.createDelegate(this)),Ext.get(this.huePicker).moveTo(Ext.get(this.cpGetId("hue")).getLeft()-3,Ext.get(this.cpGetId("hue")).getTop()-7),this.rgbPicker=Ext.DomHelper.append(this.body,{cls:"x-cp-rgbslider"}),this.rgbDD=new Ext.dd.DD(this.rgbPicker,"rgbPicker"),this.rgbDD.constrainTo(this.cpGetId("rgb"),-7),this.rgbDD.onDrag=this.moveRGBPicker.createDelegate(this),Ext.get(this.cpGetId("rgb")).on("mousedown",this.clickRGBPicker.createDelegate(this)),Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()-7,Ext.get(this.cpGetId("rgb")).getTop()-7),this.formPanel=new Ext.form.FormPanel({renderTo:Ext.DomHelper.append(this.body,{id:this.cpGetId("fCont"),cls:"x-cp-formcontainer"},!0),frame:!0,labelAlign:"left",labelWidth:10,forceLayout:!0,items:[{layout:"column",items:[{columnWidth:.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:!1,labelSeparator:""},items:[{fieldLabel:"R",id:this.cpGetId("iRed")},{fieldLabel:"G",id:this.cpGetId("iGreen")},{fieldLabel:"B",id:this.cpGetId("iBlue")}]},{columnWidth:.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:!1,labelSeparator:""},items:[{fieldLabel:"H",maxValue:360,id:this.cpGetId("iHue")},{fieldLabel:"S",id:this.cpGetId("iSat")},{fieldLabel:"V",id:this.cpGetId("iVal")}]}]},{layout:"form",defaultType:"textfield",labelAlign:"left",defaults:{width:82,value:"000000",labelSeparator:"",allowBlank:!1},id:this.cpGetId("cCont"),items:[{fieldLabel:"#",id:this.cpGetId("iHexa"),value:"000000"}]}]}),Ext.getCmp(this.cpGetId("iRed")).on("change",this.updateFromIRGB.createDelegate(this)),Ext.getCmp(this.cpGetId("iGreen")).on("change",this.updateFromIRGB.createDelegate(this)),Ext.getCmp(this.cpGetId("iBlue")).on("change",this.updateFromIRGB.createDelegate(this)),Ext.getCmp(this.cpGetId("iHue")).on("change",this.updateFromIHSV.createDelegate(this)),Ext.getCmp(this.cpGetId("iSat")).on("change",this.updateFromIHSV.createDelegate(this)),Ext.getCmp(this.cpGetId("iVal")).on("change",this.updateFromIHSV.createDelegate(this)),Ext.getCmp(this.cpGetId("iHexa")).on("change",this.updateFromIHexa.createDelegate(this)),Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cWebSafe")},!0).update("Websafe"),Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cInverse")},!0).update("Inverse"),Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cColor")},!0).update("Pick Color"),Ext.get(this.cpGetId("cWebSafe")).on("click",this.updateFromBox.createDelegate(this)),Ext.get(this.cpGetId("cInverse")).on("click",this.updateFromBox.createDelegate(this)),Ext.get(this.cpGetId("cColor")).on("click",this.selectColor.createDelegate(this)),Ext.DomHelper.append(this.body,{tag:"br",cls:"x-cp-clearfloat"})},cpGetId:function(t){return this.getId()+"__"+(t||"cp")},updateRGBPosition:function(t,e){this.updateMode="click",t=t<0?0:t,t=t>181?181:t,e=e<0?0:e,e=e>181?181:e,this.HSV.s=this.getSaturation(t),this.HSV.v=this.getValue(e),Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+t-7,Ext.get(this.cpGetId("rgb")).getTop()+e-7,this.animateMove||!0),this.updateColor()},updateHUEPosition:function(t){this.updateMode="click",t=t<1?1:t,t=t>181?181:t,this.HSV.h=Math.round(360/181*(181-t)),Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+t-7,this.animateMove||!0),this.updateRGBPicker(this.HSV.h),this.updateColor()},clickRGBPicker:function(t,e){this.updateRGBPosition(t.xy[0]-Ext.get(this.cpGetId("rgb")).getLeft(),t.xy[1]-Ext.get(this.cpGetId("rgb")).getTop())},clickHUEPicker:function(t,e){this.updateHUEPosition(t.xy[1]-Ext.get(this.cpGetId("hue")).getTop())},moveRGBPicker:function(t){this.rgbDD.constrainTo(this.cpGetId("rgb"),-7),this.updateRGBPosition(Ext.get(this.rgbPicker).getLeft()-Ext.get(this.cpGetId("rgb")).getLeft()+7,Ext.get(this.rgbPicker).getTop()-Ext.get(this.cpGetId("rgb")).getTop()+7)},moveHuePicker:function(t){this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3}),this.updateHUEPosition(Ext.get(this.huePicker).getTop()-Ext.get(this.cpGetId("hue")).getTop()+7)},updateRGBPicker:function(t){this.updateMode="click",Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(t,1,1))}),this.updateColor()},updateColor:function(){var t=this.hsvToRgb(this.HSV.h,this.HSV.s,this.HSV.v),e=this.websafe(t),i=this.invert(t),o=this.invert(e);"hexa"!==this.updateMode&&Ext.getCmp(this.cpGetId("iHexa")).setValue(this.rgbToHex(t)),"rgb"!==this.updateMode&&(Ext.getCmp(this.cpGetId("iRed")).setValue(t[0]),Ext.getCmp(this.cpGetId("iGreen")).setValue(t[1]),Ext.getCmp(this.cpGetId("iBlue")).setValue(t[2])),"hsv"!==this.updateMode&&(Ext.getCmp(this.cpGetId("iHue")).setValue(Math.round(this.HSV.h)),Ext.getCmp(this.cpGetId("iSat")).setValue(Math.round(100*this.HSV.s)),Ext.getCmp(this.cpGetId("iVal")).setValue(Math.round(100*this.HSV.v))),Ext.get(this.cpGetId("cColor")).setStyle({background:"#"+this.rgbToHex(t),color:"#"+this.rgbToHex(i)}),Ext.getDom(this.cpGetId("cColor")).title="#"+this.rgbToHex(t),Ext.get(this.cpGetId("cInverse")).setStyle({background:"#"+this.rgbToHex(i),color:"#"+this.rgbToHex(t)}),Ext.getDom(this.cpGetId("cInverse")).title="#"+this.rgbToHex(i),Ext.get(this.cpGetId("cWebSafe")).setStyle({background:"#"+this.rgbToHex(e),color:"#"+this.rgbToHex(o)}),Ext.getDom(this.cpGetId("cWebSafe")).title="#"+this.rgbToHex(e),Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+this.getHPos(Ext.getCmp(this.cpGetId("iHue")).getValue())-7,this.animateMove||!0),Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+this.getSPos(Ext.getCmp(this.cpGetId("iSat")).getValue()/100)-7,Ext.get(this.cpGetId("hue")).getTop()+this.getVPos(Ext.getCmp(this.cpGetId("iVal")).getValue()/100)-7,this.animateMove||!0),Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(Ext.getCmp(this.cpGetId("iHue")).getValue(),1,1))})},setColor:function(t){/^[0-9a-fA-F]{6}$/.test(t)&&(Ext.getCmp(this.cpGetId("iHexa")).setValue(t),this.updateFromIHexa())},updateFromIRGB:function(t,e,i){this.updateMode="rgb";var o=this.rgbToHsv(Ext.getCmp(this.cpGetId("iRed")).getValue(),Ext.getCmp(this.cpGetId("iGreen")).getValue(),Ext.getCmp(this.cpGetId("iBlue")).getValue());this.HSV={h:o[0],s:o[1],v:o[2]},this.updateColor()},updateFromIHSV:function(t,e,i){this.updateMode="hsv",this.HSV={h:Ext.getCmp(this.cpGetId("iHue")).getValue(),s:Ext.getCmp(this.cpGetId("iSat")).getValue()/100,v:Ext.getCmp(this.cpGetId("iVal")).getValue()/100},this.updateColor()},updateFromIHexa:function(t,e,i){this.updateMode="hexa";var o=this.rgbToHsv(this.hexToRgb(Ext.getCmp(this.cpGetId("iHexa")).getValue()));this.HSV={h:o[0],s:o[1],v:o[2]},this.updateColor()},updateFromBox:function(t,e){this.updateMode="click";var i=this.rgbToHsv(this.hexToRgb(Ext.get(e).getColor("backgroundColor","","")));this.HSV={h:i[0],s:i[1],v:i[2]},this.updateColor()},selectColor:function(t,e){this.fireEvent("select",this,Ext.get(e).getColor("backgroundColor","",""))},hsvToRgb:function(t,e,i){if(t instanceof Array)return this.hsvToRgb.call(this,t[0],t[1],t[2]);var o,s,h,r,a,c,n,l;switch(r=Math.floor(t/60%6),a=t/60-r,c=i*(1-e),n=i*(1-a*e),l=i*(1-(1-a)*e),r){case 0:o=i,s=l,h=c;break;case 1:o=n,s=i,h=c;break;case 2:o=c,s=i,h=l;break;case 3:o=c,s=n,h=i;break;case 4:o=l,s=c,h=i;break;case 5:o=i,s=c,h=n;break}return[this.realToDec(o),this.realToDec(s),this.realToDec(h)]},rgbToHsv:function(t,e,i){if(t instanceof Array)return this.rgbToHsv.call(this,t[0],t[1],t[2]);t/=255,e/=255,i/=255;var o,s,h,r,a,c;switch(o=Math.min(Math.min(t,e),i),s=Math.max(Math.max(t,e),i),h=s-o,s){case o:r=0;break;case t:r=60*(e-i)/h,e<i&&(r+=360);break;case e:r=60*(i-t)/h+120;break;case i:r=60*(t-e)/h+240;break}return a=0===s?0:1-o/s,[Math.round(r),a,s]},realToDec:function(t){return Math.min(255,Math.round(256*t))},rgbToHex:function(t,e,i){return t instanceof Array?this.rgbToHex.call(this,t[0],t[1],t[2]):this.decToHex(t)+this.decToHex(e)+this.decToHex(i)},decToHex:function(t){var e="0123456789ABCDEF";return t=parseInt(t,10),t=isNaN(t)?0:t,t=t>255||t<0?0:t,e.charAt((t-t%16)/16)+e.charAt(t%16)},getHCharPos:function(t){return"0123456789ABCDEF".indexOf(t.toUpperCase())},hexToDec:function(t){var e=t.split("");return 16*this.getHCharPos(e[0])+this.getHCharPos(e[1])},hexToRgb:function(t){return[this.hexToDec(t.substr(0,2)),this.hexToDec(t.substr(2,2)),this.hexToDec(t.substr(4,2))]},getHue:function(t){var e=360-Math.round((181-t)/181*360);return 360===e?0:e},getHPos:function(t){return 181-t*(181/360)},getSaturation:function(t){return t/181},getSPos:function(t){return 181*t},getValue:function(t){return(181-t)/181},getVPos:function(t){return 181-181*t},checkSafeNumber:function(t){if(!isNaN(t)){t=Math.min(Math.max(0,t),255);var e,i;for(e=0;e<256;e+=51)if(i=e+51,t>=e&&t<=i)return t-e>25?i:e}return t},websafe:function(t,e,i){return t instanceof Array?this.websafe.call(this,t[0],t[1],t[2]):[this.checkSafeNumber(t),this.checkSafeNumber(e),this.checkSafeNumber(i)]},invert:function(t,e,i){return t instanceof Array?this.invert.call(this,t[0],t[1],t[2]):[255-t,255-e,255-i]}}),Ext.ux.ColorDialog=Ext.extend(Ext.Window,{initComponent:function(){this.width=!this.width||this.width<353?353:this.width,this.applyDefaultsCP(),Ext.ux.ColorDialog.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorDialog.superclass.onRender.apply(this,arguments),this.renderComponent()}}),Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype),Ext.ux.ColorPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.width=!this.width||this.width<300?300:this.width,this.applyDefaultsCP(),Ext.ux.ColorPanel.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorPanel.superclass.onRender.apply(this,arguments),this.renderComponent()}}),Ext.applyIf(Ext.ux.ColorPanel.prototype,Ext.ux.ColorPicker.prototype),Ext.reg("colorpicker",Ext.ux.ColorPicker),Ext.reg("colordialog",Ext.ux.ColorDialog),Ext.reg("colorpanel",Ext.ux.ColorPanel);