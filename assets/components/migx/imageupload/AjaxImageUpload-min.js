!function($){$.fn.ajaxFileUpload=function(e){var i=$.extend({debug:!1,uploadAction:"",uid:"",uploadTemplate:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',deleteTemplate:'<div class="delete-button">Delete image</div>',clearTemplate:'<div class="qq-clear-button">Delete all images</div>',thumbX:"100px",thumbY:"100px",allowedExtensions:[],sizeLimit:0,messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."}},e);return this.each(function(){var e=$(this),l=e.find(".file-uploader-uploads"),a=new qq.FileUploader({element:e.find(".file-uploader-buttons")[0],action:i.uploadAction,params:{uid:i.uid},template:i.uploadTemplate,fileTemplate:i.fileTemplate,allowedExtensions:i.allowedExtensions,sizeLimit:i.sizeLimit,messages:i.messages,onComplete:function(a,t,s){var n=s.url,o=s.html,d=s.microtime;if(s.success){l.append(o);var u=$("#"+d).click(function(){var e=u.parent();$.get(i.uploadAction,{delete:n,uid:i.uid},function(l){l.success&&(e.fadeOut(function(){$(this).remove()}),i.debug&&alert(JSON.stringify(l)+"\nImage "+n+" deleted."))},"json")});e.find(".qq-upload-list li").eq(a).hide(),i.debug&&alert("ID:"+a+"\nResponse:"+JSON.stringify(s))}}}),t=$(i.clearTemplate).click(function(){$.get(i.uploadAction,{delete:"all",uid:i.uid},function(a){a.success&&(l.empty(),e.find(".qq-upload-list li").remove(),i.debug&&alert(JSON.stringify(deleteAnswer)+"\nAll Images deleted."))},"json")});$(".image-wrap .delete-button").click(function(){var e=$(this).parent(),l=e.attr("class"),a=l.split("-url-")[1];void 0!==a&&""!=a&&$.get(i.uploadAction,{delete:a,uid:i.uid},function(l){l.success&&(e.fadeOut(function(){$(this).remove()}),i.debug&&alert(JSON.stringify(l)+"\nImage "+a+" deleted."))},"json")}),e.find(".qq-upload-button").after(t)})}}(jQuery);