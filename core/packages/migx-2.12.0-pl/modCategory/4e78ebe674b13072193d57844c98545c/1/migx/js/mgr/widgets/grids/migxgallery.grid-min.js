MODx.grid.Object=function(e){e=e||{},this.sm=new Ext.grid.CheckboxSelectionModel,Ext.applyIf(e,{url:Xdbedit.config.connector_url,baseParams:{action:"mgr/xdbedit/getList",configs:e.configs},fields:["id","pagetitle","jobtitle","createdon","published","deleted"],paging:!0,autosave:!1,remoteSort:!0,primaryKey:"id",isModified:!1,sm:this.sm,columns:[this.sm,{header:"id",dataIndex:"id",sortable:!0,width:50},{header:"Pagetitle",dataIndex:"pagetitle",sortable:!0,width:200},{header:"Job Title",dataIndex:"jobtitle",sortable:!0,width:300},{header:"Created on",dataIndex:"createdon",sortable:!0,width:200},{header:"Published",dataIndex:"published",sortable:!0,width:200}],tbar:[{xtype:"buttongroup",id:"filter-buttongroup",title:"Filter",columns:8,defaults:{scale:"large"},items:[{text:"Region:"},{xtype:"xdbedit-combo-region",id:"xdbedit-filter-region",itemId:"region",value:"all",width:120,listeners:{select:{fn:this.changeRegion,scope:this}}},{text:_("year")+":"},{xtype:"xdbedit-combo-year",id:"xdbedit-filter-year",itemId:"year",value:"all",width:120,listeners:{select:{fn:this.changeYear,scope:this}}},{text:_("month")+":"},{xtype:"xdbedit-combo-month",id:"xdbedit-filter-month",itemId:"month",value:"all",width:120,listeners:{select:{fn:this.changeMonth,scope:this}}}]},{xtype:"buttongroup",title:"Aktionen",columns:2,defaults:{scale:"large"},items:[{text:_(Xdbedit.customconfigs.task+".bulk_actions")||_("xdbedit.bulk_actions"),menu:[{text:_(Xdbedit.customconfigs.task+".publish_selected")||_("xdbedit.publish_selected"),handler:this.publishSelected,scope:this},{text:_(Xdbedit.customconfigs.task+".unpublish_selected")||_("xdbedit.unpublish_selected"),handler:this.unpublishSelected,scope:this},{text:_(Xdbedit.customconfigs.task+".delete_selected")||_("xdbedit.delete_selected"),handler:this.deleteSelected,scope:this}]},{text:_(Xdbedit.customconfigs.task+".show_trash")||_("xdbedit.show_trash"),handler:this.toggleDeleted,enableToggle:!0,scope:this}]}],viewConfig:{forceFit:!0,getRowClass:function(e,t,i){var s="xdbedit-object";return e.data.published||(s+=" xdbedit-unpublished"),e.data.deleted&&(s+=" xdbedit-deleted"),s}}}),MODx.grid.Object.superclass.constructor.call(this,e),this.getStore().on("load",this.onStoreLoad,this)},Ext.extend(MODx.grid.Object,MODx.grid.Grid,{_renderUrl:function(e,t,i){return'<a href="'+e+'" target="_blank">'+i.data.pagetitle+"</a>"},editObject:function(){formpanel=Ext.getCmp("modx-panel-resource"),formpanel.autoLoad.params.object_id=this.menu.record.id,formpanel.autoLoad.params.region=null,formpanel.doAutoLoad()},createObject:function(){formpanel=Ext.getCmp("modx-panel-resource"),formpanel.autoLoad.params.object_id="neu",formpanel.autoLoad.params.region=null,formpanel.doAutoLoad()},publishObject:function(){MODx.Ajax.request({url:this.config.url,params:{action:"mgr/xdbedit/update",task:"publish",object_id:this.menu.record.id,configs:this.config.configs},listeners:{success:{fn:this.refresh,scope:this}}})},deleteObject:function(){MODx.Ajax.request({url:this.config.url,params:{action:"mgr/xdbedit/update",task:"delete",object_id:this.menu.record.id,configs:this.config.configs},listeners:{success:{fn:this.refresh,scope:this}}})},recallObject:function(){MODx.Ajax.request({url:this.config.url,params:{action:"mgr/xdbedit/update",task:"recall",object_id:this.menu.record.id,configs:this.config.configs},listeners:{success:{fn:this.refresh,scope:this}}})},removeObject:function(){MODx.Ajax.request({url:this.config.url,params:{action:"mgr/"+Xdbedit.customconfigs.task+"/remove",task:"removeone",object_id:this.menu.record.id,configs:this.config.configs},listeners:{success:{fn:this.refresh,scope:this}}})},unpublishObject:function(){MODx.Ajax.request({url:this.config.url,params:{action:"mgr/xdbedit/update",task:"unpublish",object_id:this.menu.record.id,configs:this.config.configs},listeners:{success:{fn:this.refresh,scope:this}}})},toggleDeleted:function(e,t){var i=this.getStore();e.pressed?(i.setBaseParam("showtrash",1),e.setText(_(Xdbedit.customconfigs.task+".show_normal")||_("xdbedit.show_normal"))):(i.setBaseParam("showtrash",0),e.setText(_(Xdbedit.customconfigs.task+".show_trash")||_("xdbedit.show_trash"))),this.getBottomToolbar().changePage(1),i.removeAll(),this.refresh()},getSelectedAsList:function(){var e=this.getSelectionModel().getSelections();if(e.length<=0)return!1;for(var t="",i=0;i<e.length;i++)t+=","+e[i].data.id;return t=Ext.util.Format.substr(t,1,t.length-1)},publishSelected:function(e,t){var i=this.getSelectedAsList();return!1!==i&&(MODx.Ajax.request({url:this.config.url,params:{action:"mgr/"+Xdbedit.customconfigs.task+"/bulkupdate",configs:this.config.configs,task:"publish",objects:i},listeners:{success:{fn:function(e){this.getSelectionModel().clearSelections(!0),this.refresh()},scope:this}}}),!0)},unpublishSelected:function(e,t){var i=this.getSelectedAsList();return!1!==i&&(MODx.Ajax.request({url:this.config.url,params:{action:"mgr/"+Xdbedit.customconfigs.task+"/bulkupdate",configs:this.config.configs,task:"unpublish",objects:i},listeners:{success:{fn:function(e){this.getSelectionModel().clearSelections(!0),this.refresh()},scope:this}}}),!0)},deleteSelected:function(e,t){var i=this.getSelectedAsList();return!1!==i&&(MODx.Ajax.request({url:this.config.url,params:{action:"mgr/"+Xdbedit.customconfigs.task+"/bulkupdate",configs:this.config.configs,task:"delete",objects:i},listeners:{success:{fn:function(e){this.getSelectionModel().clearSelections(!0),this.refresh()},scope:this}}}),!0)},changeYear:function(e,t,i){this.setFilterParams({year:e.getValue(),month:"all"})},changeMonth:function(e,t,i){this.setFilterParams({month:e.getValue()})},changeRegion:function(e,t,i){this.setFilterParams({region:e.getValue()})},onStoreLoad:function(){if(this.isModified){var e=this.getTopToolbar();if(!e)return!1;ycb=e.getComponent("year"),ycb&&ycb.store.load({callback:function(){ycb.collapse()}}),mcb=e.getComponent("month"),mcb&&mcb.store.load({callback:function(){mcb.collapse()}})}this.isModified=!1},setFilterParams:function(e){if(!this.getTopToolbar())return!1;var t=null,i=null,s=null;e.region&&(e.month=e.month||"all",e.year=e.year||"all",Ext.getCmp("xdbedit-filter-region").setValue(e.region),(i=Ext.getCmp("xdbedit-filter-year"))&&(i.store.baseParams.region=e.region,i.store.load({callback:function(){i.setValue("all")}}))),e.year&&(e.month=e.month||"all",Ext.getCmp("xdbedit-filter-year").setValue(e.year),(s=Ext.getCmp("xdbedit-filter-month"))&&(s.store.baseParams.year=e.year,e.region&&(s.store.baseParams.region=e.region),s.store.load({callback:function(){s.setValue(e.month)}})));var o=this.getStore();o&&(e.year&&(o.baseParams.year=e.year),e.month&&(o.baseParams.month=e.month),e.region&&(o.baseParams.region=e.region),o.removeAll()),this.getBottomToolbar().changePage(1),this.refresh()},getMenu:function(){var e=this.menu.record,t=[];t.push({text:_(Xdbedit.customconfigs.task+".edit")||_("xdbedit.edit"),handler:this.editObject}),t.push("-"),t.push({text:_(Xdbedit.customconfigs.task+".create")||_("xdbedit.create"),handler:this.createObject}),t.push("-"),0==e.published?t.push({text:_(Xdbedit.customconfigs.task+".publish")||_("xdbedit.publish"),handler:this.publishObject}):1==e.published&&t.push({text:_(Xdbedit.customconfigs.task+".unpublish")||_("xdbedit.unpublish"),handler:this.unpublishObject}),t.push("-"),1==e.deleted?(t.push({text:_(Xdbedit.customconfigs.task+".recall")||_("xdbedit.recall"),handler:this.recallObject}),t.push("-"),t.push({text:_(Xdbedit.customconfigs.task+".remove")||_("xdbedit.remove"),handler:this.removeObject})):0==e.deleted&&t.push({text:_(Xdbedit.customconfigs.task+".delete")||_("xdbedit.delete"),handler:this.deleteObject}),this.addContextMenuItem(t)}}),Ext.reg("xdbedit-grid-objects",MODx.grid.Object),MODx.combo.Month=function(e){e=e||{},Ext.applyIf(e,{name:"month",hiddenName:"month",forceSelection:!0,typeAhead:!1,editable:!1,allowBlank:!1,listWidth:300,resizable:!1,pageSize:0,url:Xdbedit.config.connector_url,fields:["optionname"],displayField:"optionname",valueField:"optionname",baseParams:{action:"mgr/"+Xdbedit.customconfigs.task+"/getdates",configs:Xdbedit.config.configs,mode:"month",year:"all"}}),MODx.combo.Month.superclass.constructor.call(this,e)},Ext.extend(MODx.combo.Month,MODx.combo.ComboBox),Ext.reg("xdbedit-combo-month",MODx.combo.Month),MODx.combo.Year=function(e){e=e||{},Ext.applyIf(e,{name:"year",hiddenName:"year",forceSelection:!0,typeAhead:!1,editable:!1,allowBlank:!1,listWidth:300,resizable:!1,pageSize:0,url:Xdbedit.config.connector_url,fields:["optionname"],displayField:"optionname",valueField:"optionname",baseParams:{action:"mgr/"+Xdbedit.customconfigs.task+"/getdates",configs:Xdbedit.config.configs,mode:"year"}}),MODx.combo.Year.superclass.constructor.call(this,e)},Ext.extend(MODx.combo.Year,MODx.combo.ComboBox),Ext.reg("xdbedit-combo-year",MODx.combo.Year),MODx.combo.Region=function(e){e=e||{},Ext.applyIf(e,{name:"region",hiddenName:"region",forceSelection:!0,typeAhead:!1,editable:!1,allowBlank:!1,listWidth:300,resizable:!1,pageSize:0,url:Xdbedit.config.connector_url,fields:["name"],displayField:"name",valueField:"name",baseParams:{action:"mgr/"+Xdbedit.customconfigs.task+"/getregions",configs:Xdbedit.config.configs}}),MODx.combo.Region.superclass.constructor.call(this,e)},Ext.extend(MODx.combo.Region,MODx.combo.ComboBox),Ext.reg("xdbedit-combo-region",MODx.combo.Region);